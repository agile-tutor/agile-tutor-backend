<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="es"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>TutorRestService.kt</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">agiletutor</a> &gt; <a href="index.source.html" class="el_package">ar.edu.unq.agiletutor.webservice</a> &gt; <span class="el_source">TutorRestService.kt</span></div><h1>TutorRestService.kt</h1><pre class="source lang-java linenums">package ar.edu.unq.agiletutor.webservice

import ar.edu.unq.agiletutor.service.*
import org.springframework.beans.factory.annotation.Autowired
import org.springframework.boot.autoconfigure.EnableAutoConfiguration
import org.springframework.http.ResponseEntity
import org.springframework.web.bind.annotation.*
import java.util.HashMap

<span class="fc" id="L10">@RestController</span>
@EnableAutoConfiguration
@CrossOrigin(&quot;*&quot;)
<span class="fc" id="L13">class TutorRestService {</span>

    @Autowired
    private lateinit var tutorService: TutorService
    private val builder: ResponseEntity.BodyBuilder? = null

    /**register a tutor*/
    @PostMapping(&quot;/api/tutor/register&quot;)
    fun register(@RequestBody tutordata: TutorRegisterDTO): ResponseEntity&lt;*&gt; {
        var response: ResponseEntity&lt;*&gt;?

<span class="nc" id="L24">        try {</span>

<span class="nc bnc" id="L26" title="All 2 branches missed.">            val tutorview = TutorDTO.desdeModelo(tutorService.register(tutordata.aModelo()))</span>

<span class="nc" id="L28">            ResponseEntity.status(201)</span>
<span class="nc" id="L29">            response = ResponseEntity.ok().body(tutorview)</span>
<span class="nc" id="L30">        } catch (e: Exception) {</span>
<span class="nc" id="L31">            ResponseEntity.status(404)</span>

<span class="nc" id="L33">            val resultado: MutableMap&lt;String, String&gt; = HashMap()</span>
<span class="nc" id="L34">            resultado[&quot;email of tutor already exist&quot;] = tutordata.email.toString()</span>
<span class="nc" id="L35">            response = ResponseEntity.badRequest().body&lt;Map&lt;String, String&gt;&gt;(resultado)</span>
        }
<span class="nc" id="L37">        return response!!</span>
    }

    @GetMapping(&quot;/api/tutor&quot;)
    fun allTutors(): ResponseEntity&lt;*&gt; {
<span class="nc bnc" id="L42" title="All 2 branches missed.">        val tutors = tutorService.findAll().map { TutorDTO.desdeModelo(it) }</span>

<span class="nc" id="L44">        return ResponseEntity.ok().body(tutors)</span>
    }

    /**login a tutor*/
    @PostMapping(&quot;/api/tutor/login&quot;)
    fun login(@RequestBody tutor: TutorLoginDTO): ResponseEntity&lt;*&gt; {
        var response: ResponseEntity&lt;*&gt;?
<span class="nc" id="L51">        try {</span>
<span class="nc bnc" id="L52" title="All 2 branches missed.">            val tutorview = TutorDTO.desdeModelo(tutorService.login(tutor.email, tutor.password))</span>

<span class="nc" id="L54">            ResponseEntity.status(200)</span>
<span class="nc" id="L55">            response = ResponseEntity.ok().body(tutorview)</span>
<span class="nc" id="L56">        } catch (e: Exception) {</span>
<span class="nc" id="L57">            ResponseEntity.status(404)</span>
<span class="nc" id="L58">            val resultado: MutableMap&lt;String, String&gt; = HashMap()</span>
<span class="nc" id="L59">            resultado[&quot;tutor not found&quot;] = tutor.email</span>
<span class="nc" id="L60">            response = ResponseEntity.badRequest().body&lt;Map&lt;String, String&gt;&gt;(resultado)</span>
        }
<span class="nc" id="L62">        return response!!</span>
    }

    /**get tutor by id**/
    @GetMapping(&quot;/api/tutor/{id}&quot;)
    fun tutorById(@PathVariable(&quot;id&quot;) id: Int): ResponseEntity&lt;*&gt; {
        var response: ResponseEntity&lt;*&gt;?
<span class="nc" id="L69">        try {</span>
<span class="nc bnc" id="L70" title="All 2 branches missed.">            val tutorView = TutorDTO.desdeModelo(tutorService.findByID(id))</span>

<span class="nc" id="L72">            ResponseEntity.status(200)</span>
<span class="nc" id="L73">            response = ResponseEntity.ok().body(tutorView)</span>
<span class="nc" id="L74">        } catch (e: Exception) {</span>
<span class="nc" id="L75">            ResponseEntity.status(404)</span>
<span class="nc" id="L76">            val resultado: MutableMap&lt;String, String&gt; = HashMap()</span>
<span class="nc" id="L77">            resultado[&quot;tutor with id not found&quot;] = id.toString()</span>
<span class="nc" id="L78">            response = ResponseEntity.badRequest().body&lt;Map&lt;String, String&gt;&gt;(resultado)</span>
        }
<span class="nc" id="L80">        return response!!</span>
    }

    /**get tutor by email**/
    @GetMapping(&quot;/api/tutor/email/{email}&quot;)
    fun tutorByEmail(@PathVariable(&quot;email&quot;) email: String): ResponseEntity&lt;*&gt; {
        var response: ResponseEntity&lt;*&gt;?
<span class="nc" id="L87">        try {</span>
<span class="nc bnc" id="L88" title="All 2 branches missed.">            val tutorView = TutorDTO.desdeModelo(tutorService.findByEmail(email))</span>

<span class="nc" id="L90">            ResponseEntity.status(200)</span>
<span class="nc" id="L91">            response = ResponseEntity.ok().body(tutorView)</span>
<span class="nc" id="L92">        } catch (e: Exception) {</span>
<span class="nc" id="L93">            ResponseEntity.status(404)</span>
<span class="nc" id="L94">            val resultado: MutableMap&lt;String, String&gt; = HashMap()</span>
<span class="nc" id="L95">            resultado[&quot;tutor with email not found&quot;] = email</span>
<span class="nc" id="L96">            response = ResponseEntity.badRequest().body&lt;Map&lt;String, String&gt;&gt;(resultado)</span>
        }
<span class="nc" id="L98">        return response!!</span>
    }

    /** Update*/
    @PutMapping(&quot;/api/tutor/{id}&quot;)
    fun update(@PathVariable(&quot;id&quot;) id: Int, @RequestBody entity: TutorRegisterDTO): ResponseEntity&lt;*&gt; {
        var response: ResponseEntity&lt;*&gt;?
<span class="nc" id="L105">        try {</span>
<span class="nc bnc" id="L106" title="All 2 branches missed.">            val userview = tutorService.update(id, entity)</span>

<span class="nc" id="L108">            ResponseEntity.status(200)</span>
<span class="nc" id="L109">            response = ResponseEntity.ok().body(userview)</span>
<span class="nc" id="L110">        } catch (e: Exception) {</span>
<span class="nc" id="L111">            ResponseEntity.status(404)</span>

<span class="nc" id="L113">            val resultado: MutableMap&lt;String, String&gt; = HashMap()</span>
            //resultado[&quot;Not found Tutor with id&quot;] = id.toString()
<span class="nc" id="L115">            resultado[&quot;Exception&quot;] = e.message.toString()</span>
<span class="nc" id="L116">            response = ResponseEntity.badRequest().body&lt;Map&lt;String, String&gt;&gt;(resultado)</span>
        }
<span class="nc" id="L118">        return response!!</span>
    }

    /**Delete tutor by id*/
    @DeleteMapping(&quot;/api/tutor/{id}&quot;)
    fun deleteTutorById(@PathVariable(&quot;id&quot;) id: Int): ResponseEntity&lt;*&gt; {
        var response: ResponseEntity&lt;*&gt;?
<span class="nc" id="L125">        try {</span>
<span class="nc bnc" id="L126" title="All 2 branches missed.">            tutorService.deleteById(id)</span>
<span class="nc" id="L127">            val resultado: MutableMap&lt;String, Int&gt; = HashMap()</span>
<span class="nc" id="L128">            resultado[&quot;succesfully tutor deleted with iD&quot;] = id</span>
<span class="nc" id="L129">            response = ResponseEntity.ok().body&lt;Map&lt;String, Int&gt;&gt;(resultado)</span>

<span class="nc" id="L131">        } catch (e: Exception) {</span>
<span class="nc" id="L132">            ResponseEntity.status(404)</span>

<span class="nc" id="L134">            val resultado: MutableMap&lt;String, String&gt; = HashMap()</span>
<span class="nc" id="L135">            resultado[&quot;tutor with id not found&quot;] = id.toString()</span>
<span class="nc" id="L136">            response = ResponseEntity.badRequest().body&lt;Map&lt;String, String&gt;&gt;(resultado)</span>
        }
<span class="nc" id="L138">        return response!!</span>
    }

    /**Courses From a Tutor*/
    @GetMapping(&quot;/api/tutor/courses/{id}&quot;)
    fun coursesFromATutor(@PathVariable(&quot;id&quot;) id: Int): ResponseEntity&lt;*&gt; {
        var response: ResponseEntity&lt;*&gt;?
<span class="nc" id="L145">        try {</span>
<span class="nc bnc" id="L146" title="All 2 branches missed.">            val courses = tutorService.coursesFromATutor(id).map { CourseDTO.desdeModelo(it) }</span>
<span class="nc" id="L147">            ResponseEntity.status(200)</span>

<span class="nc" id="L149">            response = ResponseEntity.ok().body(courses)</span>
<span class="nc" id="L150">        } catch (e: Exception) {</span>
<span class="nc" id="L151">            ResponseEntity.status(404)</span>

<span class="nc" id="L153">            val resultado: MutableMap&lt;String, String&gt; = HashMap()</span>
<span class="nc" id="L154">            resultado[&quot;Not found Tutor with id&quot;] = id.toString()</span>

<span class="nc" id="L156">            response = ResponseEntity.badRequest().body&lt;Map&lt;String, String&gt;&gt;(resultado)</span>
        }
<span class="nc" id="L158">        return response!!</span>


    }

    /**Students From a Tutor*/
    @GetMapping(&quot;/api/tutor/students/{id}&quot;)
    fun studentsFromATutor(@PathVariable(&quot;id&quot;) id: Int): ResponseEntity&lt;*&gt; {
        var response: ResponseEntity&lt;*&gt;?
<span class="nc" id="L167">        try {</span>
<span class="nc bnc" id="L168" title="All 2 branches missed.">            val students = tutorService.studentsFromATutor(id).map { StudentDTO.desdeModelo(it) }</span>
<span class="nc" id="L169">            ResponseEntity.status(200)</span>
<span class="nc" id="L170">            response = ResponseEntity.ok().body(students)</span>

<span class="nc" id="L172">        } catch (e: Exception) {</span>
<span class="nc" id="L173">            ResponseEntity.status(404)</span>

<span class="nc" id="L175">            val resultado: MutableMap&lt;String, String&gt; = HashMap()</span>
<span class="nc" id="L176">            resultado[&quot;Not found Tutor with id&quot;] = id.toString()</span>

<span class="nc" id="L178">            response = ResponseEntity.badRequest().body&lt;Map&lt;String, String&gt;&gt;(resultado)</span>
        }
<span class="nc" id="L180">        return response!!</span>


    }


    /** Move a student to Another Course*/
    @PutMapping(&quot;/api/tutor/students/move/{id}/{id_course}&quot;)
    fun moveAStudentIntoAnotherCourse(
            @PathVariable(&quot;id&quot;) id: Int, @PathVariable(&quot;id_course&quot;) id_course: Int
    ): ResponseEntity&lt;*&gt; {
        var response: ResponseEntity&lt;*&gt;?

<span class="nc" id="L193">        try {</span>
<span class="nc bnc" id="L194" title="All 2 branches missed.">            val student = tutorService.moveAStudentIntoAnotherCourse(id.toLong(), id_course)</span>
<span class="nc" id="L195">            ResponseEntity.status(201)</span>
<span class="nc" id="L196">            response = ResponseEntity.ok().body(student)</span>

<span class="nc" id="L198">        } catch (e: Exception) {</span>
<span class="nc" id="L199">            ResponseEntity.status(404)</span>

<span class="nc" id="L201">            val resultado: MutableMap&lt;String, String&gt; = HashMap()</span>
<span class="nc" id="L202">            resultado[&quot;Exception&quot;] = e.message.toString()</span>
<span class="nc" id="L203">            response = ResponseEntity.badRequest().body&lt;Map&lt;String, String&gt;&gt;(resultado)</span>
        }
<span class="nc" id="L205">        return response!!</span>
    }


    /** Absent Message From a Tutor*/
    @GetMapping(&quot;/api/tutor/absentmessage/{tutorId}&quot;)
    fun absentMessageFromTutor(@PathVariable(&quot;tutorId&quot;) tutorId: Int): ResponseEntity&lt;*&gt; {
        var response: ResponseEntity&lt;*&gt;?
<span class="nc" id="L213">        try {</span>
<span class="nc bnc" id="L214" title="All 2 branches missed.">            val notifyer = tutorService.findByID(tutorId).notifyer</span>
<span class="nc bnc" id="L215" title="All 2 branches missed.">            val message = tutorService.absentMessageFromTutor(notifyer!!)</span>
<span class="nc" id="L216">            ResponseEntity.status(200)</span>
<span class="nc" id="L217">            response = ResponseEntity.ok().body(message)</span>

<span class="nc" id="L219">        } catch (e: Exception) {</span>
<span class="nc" id="L220">            ResponseEntity.status(404)</span>

<span class="nc" id="L222">            val result: MutableMap&lt;String, String&gt; = HashMap()</span>
<span class="nc" id="L223">            result[&quot;Not found Absent Message&quot;] = &quot;Error&quot;</span>

<span class="nc" id="L225">            response = ResponseEntity.badRequest().body&lt;Map&lt;String, String&gt;&gt;(result)</span>
        }
<span class="nc" id="L227">        return response!!</span>
    }

    /** Modify Absent Message From a Tutor*/
    @PutMapping(&quot;/api/tutor/absentmessage/{tutorId}&quot;)
    fun updateAbsentMessageFromTutor(@PathVariable(&quot;tutorId&quot;) tutorId: Int, @RequestBody absentMessageDataDTO: AbsentMessageDataDTO): ResponseEntity&lt;*&gt; {
        var response: ResponseEntity&lt;*&gt;?
<span class="nc" id="L234">        try {</span>
<span class="nc bnc" id="L235" title="All 2 branches missed.">            val notifyer = tutorService.findByID(tutorId).notifyer</span>
<span class="nc bnc" id="L236" title="All 2 branches missed.">            val message = tutorService.updateAbsentMessageFromTutor(absentMessageDataDTO, notifyer!!)</span>
<span class="nc" id="L237">            ResponseEntity.status(200)</span>
<span class="nc" id="L238">            response = ResponseEntity.ok().body(message)</span>

<span class="nc" id="L240">        } catch (e: Exception) {</span>
<span class="nc" id="L241">            ResponseEntity.status(404)</span>

<span class="nc" id="L243">            val result: MutableMap&lt;String, String&gt; = HashMap()</span>
<span class="nc" id="L244">            result[&quot;Not found Absent Message&quot;] = &quot;Error&quot;</span>

<span class="nc" id="L246">            response = ResponseEntity.badRequest().body&lt;Map&lt;String, String&gt;&gt;(result)</span>
        }
<span class="nc" id="L248">        return response!!</span>
    }

    /**Students To Notify From a Tutor*/
    @GetMapping(&quot;/api/tutor/toNotify/{tutorId}&quot;)
    fun studentsToNotify(@PathVariable(&quot;tutorId&quot;) tutorId: Int): ResponseEntity&lt;*&gt; {
        var response: ResponseEntity&lt;*&gt;?
<span class="nc" id="L255">        try {</span>
<span class="nc bnc" id="L256" title="All 2 branches missed.">            val students = tutorService.studentsToNotifyFromTutor(tutorId)</span>
<span class="nc" id="L257">            ResponseEntity.status(201)</span>
<span class="nc" id="L258">            response = ResponseEntity.ok().body(students)</span>
<span class="nc" id="L259">        } catch (e: Exception) {</span>
<span class="nc" id="L260">            ResponseEntity.status(404)</span>

<span class="nc" id="L262">            val resultado: MutableMap&lt;String, String&gt; = HashMap()</span>
<span class="nc" id="L263">            resultado[&quot;Students with tutor: not found&quot;] = tutorId.toString()</span>
<span class="nc" id="L264">            response = ResponseEntity.badRequest().body&lt;Map&lt;String, String&gt;&gt;(resultado)</span>
        }
<span class="nc" id="L266">        return response!!</span>
    }

    /**remove an absent to notify*/
    @PostMapping(&quot;/api/tutor/absent/{tutorId}/{studentId}&quot;)
    fun login(@PathVariable(&quot;tutorId&quot;) tutorId: Int, @PathVariable(&quot;studentId&quot;) studentId: Int): ResponseEntity&lt;*&gt; {
        var response: ResponseEntity&lt;*&gt;?
<span class="nc" id="L273">        try {</span>
<span class="nc bnc" id="L274" title="All 2 branches missed.">            tutorService.removeAnStudentFromNotification(tutorId, studentId)</span>
<span class="nc" id="L275">            ResponseEntity.status(200)</span>
<span class="nc" id="L276">            response = ResponseEntity.ok().body { }</span>
<span class="nc" id="L277">        } catch (e: Exception) {</span>
<span class="nc" id="L278">            ResponseEntity.status(404)</span>
<span class="nc" id="L279">            val resultado: MutableMap&lt;String, String&gt; = HashMap()</span>
<span class="nc" id="L280">            resultado[&quot;an error was ocurred&quot;] = &quot;&quot;</span>
<span class="nc" id="L281">            response = ResponseEntity.badRequest().body&lt;Map&lt;String, String&gt;&gt;(resultado)</span>
        }
<span class="nc" id="L283">        return response!!</span>
    }

    /**All Surveys*/
    @GetMapping(&quot;/api/tutor/survey&quot;)
    fun allSurveys(): ResponseEntity&lt;*&gt; {
        var response: ResponseEntity&lt;*&gt;?
<span class="nc" id="L290">        try {</span>
<span class="nc bnc" id="L291" title="All 2 branches missed.">            val surveys = tutorService.getAllSurveys()</span>
<span class="nc" id="L292">            ResponseEntity.status(200)</span>
<span class="nc" id="L293">            response = ResponseEntity.ok().body(surveys)</span>

<span class="nc" id="L295">        } catch (e: Exception) {</span>
<span class="nc" id="L296">            ResponseEntity.status(404)</span>

<span class="nc" id="L298">            val resultado: MutableMap&lt;String, String&gt; = HashMap()</span>
<span class="nc" id="L299">            resultado[&quot;Not found&quot;] = &quot;Check Error&quot;</span>

<span class="nc" id="L301">            response = ResponseEntity.badRequest().body&lt;Map&lt;String, String&gt;&gt;(resultado)</span>
        }
<span class="nc" id="L303">        return response!!</span>
    }


    /** Get the percentage by Default */
    @GetMapping(&quot;/api/tutor/pecentagebydefault&quot;)
    fun percentageByDefault(): ResponseEntity&lt;*&gt; {
<span class="nc bnc" id="L310" title="All 2 branches missed.">        val percentageByDefault= tutorService.percentageByDefault()</span>

<span class="nc" id="L312">        return ResponseEntity.ok().body(percentageByDefault)</span>
    }

    /** Update Percentage by Default */
    @PostMapping(&quot;/api/tutor/pecentagebydefault/{percentage}&quot;)
    fun updatePercentageByDefault(@PathVariable(&quot;percentage&quot;) percentage: Int): ResponseEntity&lt;*&gt; {
<span class="nc bnc" id="L318" title="All 2 branches missed.">      val  percentage = tutorService.updatePercentageByDefault(percentage.toDouble())</span>
<span class="nc" id="L319">        return ResponseEntity.ok().body(percentage)</span>
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.9.202303310957</span></div></body></html>